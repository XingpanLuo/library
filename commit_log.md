# 提交说明

## 提交1 by xyp

1. 你这都没有 student 表还到处 student，我直接全替换成 reader
2. `database.py` 的 `remove_blank` 可以用 strip 方法替代。
3. 代码使用sql语句有一堆大小写问题，我基本上能改的都给改了。
4. 我的 pylint 可能不太一样，我全都重新格式化了，Markdown 也修改了一些 lint 报错。
5. database.py 的 334 行可能因为查询不到产生 NoneType，这里做了 catch 修改。
6. 同一文件 323 行的 sql 语句应该有小的引号。
7. import 未引用的我都删了（因为我这边 pylint 到处报错）
8. reader 的 lilin 我改成了 lihua

## 提交2 by xyp

1. 修改 `main_widget.py` 的 90 行增加了 reader 内容。
2. 修改 database 211,972,980 行数据错误。
3. 修改 main_widget.py

## 提交3 by xyp

1. 修改 database.py 的 search_book 逻辑

（有事暂时离开，先只提交一点）

## 提交4 by xyp

1. database.py 判断 master 逻辑错误

## 提交5 by xyp

1. 完成 reader.py 的前两个 UI 编写

## 提交6 by xyp

1. 完成读者全部 UI
2. 修复 database.py 的 update_reader 的 bug

## 提交7 by zcm

1. 新建数据库的逻辑更新
2. 更改database.py 中的一些sql语句使其符合本项目数据库设计（但不多）

## 提交8 by zcm

1. database，py的update_reader新增参数state，为1则更新密码，为0则不更新
2. 由1，更新reader.py中修改个人信息的相关部分

## 提交9 by zcm

1. 管理员界面的学生信息更新功能完成

## 提交10 by zcm

1. database.py中删除读者逻辑更新，仅在还完所有书的时候才可以删除
2. 更新管理员界面删除学生功能

## 提交11 by zcm

1. 管理员界面新增归还书籍方式 归还书籍：仅在归还日期为NULL时有按钮，归还后按钮消失
2. 更改master中returnBook函数
3. 更新database中returnbook函数

## 提交12 by lxp

1. 修正注册、登录逻辑。注册后的用户登录进入读者界面
2. 新增管理员个人信息界面，管理员可查看和修改个人信息
3. 读者和管理员个人信息界面，提交后会自动刷新

## 提交13 by lxp

1. database.py中的初始化提取到db.py中 ？

## 提交14 by xyp

1. 对提交13的初始化进行优化，把初始数据提取到 init.sql 里。
2. 修改借阅或预约逻辑在 UI 上

## 提交15 by zcm

1. 管理员界面bug修复：违期信息显示错误
2. 更新初始数据
3. 新增触发器，预约记录发生时增加最晚取书时间（仍有bug）

## 提交16 by zcm

1. 将上述触发器更改为“当插入预约记录时，更改图书状态”
2. database新增预约函数reserve
3. reader中新增预约功能

## 提交17 by xyp

修改完善数据：

- b1是被r2借完又被r1借并超期，处于状态1（借出无预约）
- b2是被r2借阅并被r3预约，处于状态2（借出无预约）
- b3是被r2借又被r3预约又被r2还，处于状态3（到馆被预约）
- b4是被r4借阅没还，处于状态1（借出无预约）
- 其他均为状态0

## 提交18 by lxp

1. 修改chooseHeadFile() 函数，支持任意路径
2. 管理员加入chooseHeadFile()

## 提交19 by xyp

1. 完善读者前端按钮限制逻辑
2. 修改 init.sql 的初始图像问题（default.png变jpg）
3. database.py 的 convert 函数不知道为什么有时候会传入不太对的字典，不过反正我改对了
4. 提醒一下 Markdown 规范要求标题和上下文要有空行

## 借阅逻辑

首先我们假设每本书同时只能有一个预约的人，且每个人借书只有60天。

1. 对某本书借书的条件：

   - 读者没有违期
   - 书籍处于状态0（在馆可借）或状态3（在馆被预约）且预约人为本人

   对应动作为：

   - 添加借书记录，如果书是状态3则删除预约记录
   - 修改书的状态为1（借出无预约）

2. 对某本书可预约的条件：

   - 读者没有违期
   - 书籍状态为1（借出无预约）

   对应动作为：

   - 添加预约记录
   - 对状态1，修改书的状态为2（借出有预约）

3. 对某本书可还书的条件：

   - 书籍被读者借阅

   对应动作为：

   - borrow添加还书日期，删除违期表（如果有）
   - 书状态1（借出无预约）变0（在馆可借），2（借出有预约）变3（在馆被预约）
   - 如有违期则要求缴纳罚款
